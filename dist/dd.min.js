!function(){angular.module("dateModule",[]),angular.module("notesModule",[]),angular.module("moodModule",[]),angular.module("loginModule",[]),angular.module("userModule",[]),angular.module("suppliesModule",[]),angular.module("alertModule",[]),angular.module("seizureModule",["ngSanitize","ngCsv"]);var e=angular.module("appDD",["dateModule","notesModule","moodModule","ui.bootstrap","firebase","loginModule","ngRoute","userModule","ngCookies","suppliesModule","alertModule","seizureModule"]);e.controller("DdController",["$scope","$uibModal",function(e,t){e.uhfOpen=function(){e.uhfModal=t.open({animation:!0,templateUrl:"uhfModalContent.html"})}}]),e.run(["$rootScope","$location",function(e,t){e.$on("$routeChangeError",function(e,n,r,o){"AUTH_REQUIRED"===o?t.path("/login"):"ADMIN_REQUIRED"===o&&t.path("/view")})}]),e.config(["$routeProvider",function(e){e.when("/view",{templateUrl:"app/partials/view.html",resolve:{currentAuth:["loginService",function(e){return e.$requireAuth()}]}}).when("/login",{templateUrl:"app/partials/login.html"}).when("/reset",{templateUrl:"app/partials/reset.html",resolve:{currentAuth:["loginService",function(e){return e.$requireAuth()}]}}).when("/admin",{templateUrl:"app/partials/admin.html",resolve:{currentAuth:["loginService",function(e){return e.$requireAuth()}],isAdmin:["userService","$q",function(e,t){var n=t.defer();return e.getCurrentUser().$loaded().then(function(e){e.admin?n.resolve():n.reject("ADMIN_REQUIRED")}),n.promise}]},admin:!0}).otherwise({redirectTo:"/view"})}])}(),function(){angular.module("alertModule").controller("AlertController",["alertService","dateService","$scope","userService",function(e,t,n,r){var o="";e.getDefaultMessage().$loaded().then(function(e){o=e}),this.hidden=!1,this.editMode=!1,this.edit=function(){n.canEdit&&(n.alert.$value===o.$value&&(this.previousMessage=o.$value,n.alert.$value=""),this.editMode=!0)},this.save=function(){this.editMode=!1,n.alert.$value.length>0?(n.alert.$save(),n.alertClass="alert-danger"):n.alert.$value=o.$value},this.cancel=function(){this.editMode=!1,this.previousMessage&&(n.alert.$value=this.previousMessage)},this.clear=function(){this.previousMessage=n.alert.$value,n.alert.$value=""},this.reset=function(){this.editMode=!1,n.alert.$remove().then(function(){n.alert.$value=o.$value}),n.alertClass="alert-warning"},this.setDefault=function(){o.$value=n.alert.$value,o.$save()};var i=function(){var r=e.getAlert(t.selectedDate);r.$loaded().then(function(e){n.alert=e,null===e.$value?(e.$value=o.$value,n.alertClass="alert-warning"):n.alertClass="alert-danger"})},l=function(){r.isCurrentUserAdmin().then(function(e){e?n.canEdit=!0:n.canEdit=!1})};n.$watch(function(){return t.selectedDate},function(){i(),l()},!0)}])}(),function(){angular.module("alertModule").directive("abAlert",function(){return{restrict:"E",templateUrl:"app/components/alert/alertView.html",controller:"AlertController",controllerAs:"alertCtrl"}})}(),function(){angular.module("alertModule").service("alertService",["$firebaseObject","$filter",function(e,t){var n="https://brilliant-inferno-6689.firebaseio.com",r=new Firebase(n);this.getAlert=function(n,o){var i=t("date")(n,"yyyy-MM-dd");return e(r.child("alerts").child(i))},this.getDefaultMessage=function(){return e(r.child("config").child("defaultMessage"))}}])}(),function(){angular.module("dateModule").controller("DateController",["dateService","$scope",function(e,t){t.date=e}])}(),function(){angular.module("dateModule").directive("abDate",function(){return{restrict:"E",templateUrl:"app/components/date/dateView.html",controller:"DateController",controllerAs:"dateCtrl"}})}(),function(){angular.module("dateModule").service("dateService",[function(){this.selectedDate=new Date,this.isToday=function(){var e=(new Date).toDateString(),t=this.selectedDate.toDateString();return t===e},this.addDays=function(e){this.selectedDate.setDate(this.selectedDate.getDate()+e)}}])}(),function(){angular.module("loginModule").controller("LoginController",["$location","loginService","$scope","$cookies",function(e,t,n,r){this.email=r.get("lastuser"),this.password="",this.login=function(){n.error=null;var o={email:this.email,password:this.password};t.$authWithPassword(o).then(function(t){t.password.isTemporaryPassword?e.path("/reset"):(r.put("lastuser",t.password.email),e.path("/view"))})["catch"](function(e){n.error=e.message})},this.clear=function(){this.email="",this.password="",n.error=null,n.success=null},this.resetPassword=function(){n.error=null,n.success=null;var e={email:this.email};t.$resetPassword(e).then(function(){n.success="Password reset sent to "+e.email})["catch"](function(e){n.error="Reset failed: "+e.message})}}]),angular.module("loginModule").controller("LoginButtonController",["$scope","loginService","$location","userService",function(e,t,n,r){e.location=n,t.$onAuth(function(t){e.authData=t,t?r.getUser(t.uid).$loaded().then(function(n){n.active?(e.username=n.name,e.isAdmin=n.admin,e.username||(e.username=t.password.email)):e.signout()}):n.path("/login")}),e.signout=function(){t.$unauth(),n.path("/login")}}]),angular.module("loginModule").controller("LoginResetController",["$scope","loginService","$location",function(e,t,n){e.changePassword=function(){if(e.new1!==e.new2)return void(e.error="New passwords don't match");var r={email:e.email,oldPassword:e.old,newPassword:e.new1};t.$changePassword(r).then(function(){n.path("/view")})["catch"](function(t){e.error=t.message})},e.cancel=function(){n.path("/view")}}])}(),function(){angular.module("loginModule").directive("abLogin",function(){return{restrict:"E",templateUrl:"app/components/login/loginView.html",controller:"LoginController",controllerAs:"loginCtrl"}}),angular.module("loginModule").directive("abLoginbutton",function(){return{restrict:"E",templateUrl:"app/components/login/loginButton.html",controller:"LoginButtonController",controllerAs:"loginButtonCtrl"}}),angular.module("loginModule").directive("abLoginreset",function(){return{restrict:"E",templateUrl:"app/components/login/loginReset.html",controller:"LoginResetController",controllerAs:"loginResetCtrl"}})}(),function(){angular.module("loginModule").factory("loginService",["$firebaseAuth",function(e){var t="https://brilliant-inferno-6689.firebaseio.com",n=new Firebase(t);return e(n)}])}(),function(){angular.module("moodModule").controller("MoodAdminController",["moodService","$scope",function(e,t){e.getMoodList().$loaded().then(function(e){t.moodList=e})}])}(),function(){angular.module("moodModule").controller("MoodController",["moodService","dateService","$scope","userService",function(e,t,n,r){e.getMoodList().$loaded().then(function(e){n.moodList=e});var o=function(){var r=e.getMoods(t.selectedDate,"am");r.$loaded().then(function(e){n.moodAM=e});var o=e.getMoods(t.selectedDate,"pm");o.$loaded().then(function(e){n.moodPM=e})},i=function(){r.isCurrentUserAdmin().then(function(e){e|t.isToday()?n.canEdit=!0:n.canEdit=!1})};n.$watch(function(){return t.selectedDate},function(){o(),i()},!0)}])}(),function(){angular.module("moodModule").directive("abMoods",function(){return{restrict:"E",templateUrl:"app/components/mood/moodView.html",controller:"MoodController",controllerAs:"moodCtrl"}}),angular.module("moodModule").directive("abMoodsadmin",function(){return{restrict:"E",templateUrl:"app/components/mood/moodViewAdmin.html",controller:"MoodAdminController",controllerAs:"moodAdminCtrl"}})}(),function(){angular.module("moodModule").service("moodService",["$firebaseObject","$firebaseArray","$filter",function(e,t,n){var r="https://brilliant-inferno-6689.firebaseio.com",o=new Firebase(r);this.getMoodList=function(){return t(o.child("config").child("moods"))},this.getMoods=function(t,r){var i=n("date")(t,"yyyy-MM-dd");return e(o.child("mood").child(i).child(r))}}])}(),function(){angular.module("notesModule").controller("NotesController",["dateService","$scope","userService","notesService",function(e,t,n,r){var o=function(){n.isCurrentUserAdmin().then(function(n){n|e.isToday()?t.canEdit=!0:t.canEdit=!1})},i=function(){n.getCurrentUser().$loaded().then(function(n){t.uuid=n.$id,t.notes=r.getNotes(e.selectedDate)})};this.addNote=function(e){n.getCurrentUser().$loaded().then(function(n){var r=(new Date).getTime(),o={what:e,when:r,who:n.name,uuid:n.$id};t.notes.$add(o),t.what=""})},t.$watch(function(){return e.selectedDate},function(){i(),o()},!0)}])}(),function(){angular.module("notesModule").directive("abNotes",function(){return{restrict:"E",templateUrl:"app/components/notes/notesView.html",controller:"NotesController",controllerAs:"notesCtrl"}})}(),function(){angular.module("notesModule").service("notesService",["$firebaseArray","$filter",function(e,t){var n="https://brilliant-inferno-6689.firebaseio.com",r=new Firebase(n);this.getNotes=function(n){var o=t("date")(n,"yyyy-MM-dd");return e(r.child("notes").child(o))}}])}(),function(){angular.module("seizureModule").controller("SeizureAdminController",["$scope","seizureService","$q","$filter",function(e,t,n,r){e.startDate=new Date,e.endDate=new Date,e.data=[],e.csvHeader=["Date","Time","Duration","Name","Notes"],this["export"]=function(){for(var o=n.defer(),i=[],l=new Date(e.startDate);l<=e.endDate;l.setDate(l.getDate()+1)){var u=t.getSeizure(l).$loaded().then(function(t){for(var n=0;n<t.length;n++){var o={date:r("date")(t[n].start,"yyyy-MM-dd"),time:r("date")(t[n].start,"HH:mm"),duration:t[n].duration,who:t[n].who,notes:t[n].notes};e.data.push(o)}return"done"});i.push(u)}return n.all(i).then(function(){o.resolve(e.data)}),o.promise}}])}(),function(){angular.module("seizureModule").controller("SeizureController",["dateService","$scope","userService","seizureService",function(e,t,n,r){var o=function(){n.isCurrentUserAdmin().then(function(n){n|e.isToday()?t.canEdit=!0:t.canEdit=!1})},i=function(){var o=(new Date).getTime();t.start=new Date(e.selectedDate).setTime(o),t.duration=0,n.getCurrentUser().$loaded().then(function(n){t.uuid=n.$id,t.activity=r.getSeizure(e.selectedDate)})};this.addActivity=function(){n.getCurrentUser().$loaded().then(function(e){var n={who:e.name,start:t.start,duration:t.duration,notes:t.notes,uuid:e.$id};t.activity.$add(n),t.what="",t.start=new Date,t.duration=0,t.notes=""})},t.$watch(function(){return e.selectedDate},function(){i(),o()},!0)}])}(),function(){angular.module("seizureModule").directive("abSeizure",function(){return{restrict:"E",templateUrl:"app/components/seizure/seizureView.html",controller:"SeizureController",controllerAs:"seizureCtrl"}}),angular.module("seizureModule").directive("abSeizureadmin",function(){return{restrict:"E",templateUrl:"app/components/seizure/seizureViewAdmin.html",controller:"SeizureAdminController",controllerAs:"seizureAdminCtrl"}})}(),function(){angular.module("seizureModule").service("seizureService",["$firebaseArray","$filter",function(e,t){var n="https://brilliant-inferno-6689.firebaseio.com",r=new Firebase(n);this.getSeizure=function(n){var o=t("date")(n,"yyyy-MM-dd");return e(r.child("seizure").child(o))}}])}(),function(){angular.module("suppliesModule").controller("SuppliesAdminController",["suppliesService","$scope",function(e,t){e.getSingleItemList().$loaded().then(function(e){t.singleItems=e}),e.getMultiItemList().$loaded().then(function(e){t.multiItems=e}),e.getSettings().$loaded().then(function(e){t.settings=e,e.$bindTo(t,"settings")})}])}(),function(){angular.module("suppliesModule").controller("SuppliesController",["suppliesService","dateService","$scope","userService",function(e,t,n,r){e.getSingleItemList().$loaded().then(function(e){n.singleItems=e}),e.getMultiItemList().$loaded().then(function(e){n.multiItems=e}),e.getSettings().$loaded().then(function(e){n.settings=e});var o=function(){r.isCurrentUserAdmin().then(function(e){e|t.isToday()?n.canEdit=!0:n.canEdit=!1})},i=function(){var r=e.getSupplies(t.selectedDate,"am");r.$loaded().then(function(){n.amSupplies=r;for(var e=0;e<n.multiItems.length;e++)n.amSupplies[n.multiItems[e].$value]=n.amSupplies[n.multiItems[e].$value]||0})},l=function(){var r=e.getSupplies(t.selectedDate,"pm");r.$loaded().then(function(){n.pmSupplies=r;for(var e=0;e<n.multiItems.length;e++)n.pmSupplies[n.multiItems[e].$value]=n.pmSupplies[n.multiItems[e].$value]||0})};n.$watch(function(){return t.selectedDate},function(){i(),l(),o()},!0)}])}(),function(){angular.module("suppliesModule").directive("abSupplies",function(){return{restrict:"E",templateUrl:"app/components/supplies/suppliesView.html",controller:"SuppliesController",controllerAs:"suppliesCtrl"}}),angular.module("suppliesModule").directive("abSuppliesadmin",function(){return{restrict:"E",templateUrl:"app/components/supplies/suppliesViewAdmin.html",controller:"SuppliesAdminController",controllerAs:"suppliesAdminCtrl"}})}(),function(){angular.module("suppliesModule").service("suppliesService",["$firebaseObject","$filter","$firebaseArray",function(e,t,n){var r="https://brilliant-inferno-6689.firebaseio.com",o=new Firebase(r);this.getSingleItemList=function(){return n(o.child("config").child("supplies").child("single"))},this.getMultiItemList=function(){return n(o.child("config").child("supplies").child("multi"))},this.getSettings=function(){return e(o.child("config").child("supplies").child("settings"))},this.getSupplies=function(n,r){var i=t("date")(n,"yyyy-MM-dd");return e(o.child("supplies").child(i).child(r))}}])}(),function(){angular.module("userModule").controller("UserController",["userService","$scope","loginService",function(e,t,n){e.getAllUsers().$loaded().then(function(e){t.users=e}),this.addUser=function(){n.$createUser({email:t.email,password:t.password}).then(function(e){t.users[e.uid]={name:t.name,email:t.email,active:!0,admin:!1},t.users.$save()})}}])}(),function(){angular.module("userModule").directive("abUsers",function(){return{restrict:"E",templateUrl:"app/components/user/userView.html",controller:"UserController",controllerAs:"userCtrl"}})}(),function(){angular.module("userModule").factory("userService",["$firebaseObject","loginService",function(e,t){var n="https://brilliant-inferno-6689.firebaseio.com",r=new Firebase(n),o={};return o.getUser=function(t){return e(r.child("users").child(t))},o.getCurrentUser=function(){var n=t.$getAuth();return n?e(r.child("users").child(n.uid)):null},o.getAllUsers=function(){return e(r.child("users"))},o.isCurrentUserAdmin=function(){var e=o.getCurrentUser();return e.$loaded().then(function(e){return e.admin})},o}])}();